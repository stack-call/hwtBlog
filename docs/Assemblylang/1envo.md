---
title: 汇编语言编程环境
description: 介绍汇编语言编程的寄存器和栈环境
tags: [Assembly]
---

# 引言
我们知道，汇编语言是比较贴近底层硬件的语言。因此，我们如果使用汇编语言编程，我们就需要了解汇编是在什么样的硬件环境下进行的操作。
# 基本执行环境的预览
本节参考Intel(R) 64 and IA-32 Architectures Software Developer's Manual(以下简称开发者手册)卷一  
>Intel64的处理器通样支持IA-32的处理器基本执行环境。
>任何在IA-32处理器上运行的程序(program)或任务(task，指的是上处理器运行的单位？)，**为了执行指令，储存代码，数据和状态信息**，都会被分配一套资源，这些资源组成了IA-32处理器上的执行环境。(只要能上处理器就可以拥有这套资源)  
:::tip
以下内容指的是IA-32的执行环境，这里的执行环境指的是硬件全部的执行环境，而非仅仅是汇编的执行环境，是汇编执行环境的超集，有一部分执行环境是汇编所不能使用的，因为这一部分被操作系统禁止了，如果你在裸机上执行汇编代码，那么这个执行环境全部可以使用。
:::

* 地址空间(Address space) —— 即处理器可以寻址的线性地址空间，这段空间有4GBytes，从0x0到0xFFFFFFFF(这部分更像是对操作系统的层面来说的，因为对于在操作系统环境下运行的汇编程序，由于段访问保护机制，以及分页机制，我们只能访问我们自己的代码段和数据段，甚至地址都是虚拟地址)
* 基本程序执行寄存器(Basic program execution registers) —— 8个通用寄存器(general-purpose registers)，6个段寄存器(segment registers)，标志寄存器(EFLAGS register)和指令寄存器(EIP,instruction pointer register)，因为这些寄存器是执行一些通用指令所必需的，因此称为基本程序执行寄存器。
* x87浮点运算寄存器(x87 FPU registers) —— 8个x87 FPU数据寄存器，x87 FPU控制寄存器，状态寄存器，x87FPU指令寄存器，x87 FPU操作码(数据)寄存器，x87 FPU tag register(不知道如何翻译),x97 FPU操作码寄存器。
* (这一部分不需要)
* 栈(Stack) 为了支持函数调用和传递参数，人们发明了栈，而IA-32同样支持栈结构及其相关指令。  

对于系统级软件而言，操作系统还提供了其他的执行资源，但是就学习汇编语言而言，以上就基本足够。  
以下是执行环境示意图。

![](https://img-blog.csdnimg.cn/2c32f4a491ff46c395b7659665d1811d.png)  
对于64位模式来说，内容基本相同，差别只是位数大小。  
以下是64位模式的执行环境示意图。  
![](https://img-blog.csdnimg.cn/3e145559b7ed4a5182c953f20f39f1fd.png)
:::info
由于操作系统充当真正的硬件操作和我们的汇编程序的中间层，我们的汇编程序无论如何接近硬件都只是一个运行在操作系统上的程序，因此，运行在操作系统上的汇编语言也不能完全的操作这里所提到的基本执行环境(理论上来说在CPU上跑的程序都可以，但是会被操作系统设置的访问保护机制拒绝)，就例如写汇编程序经常遇见的段错误，可能就是因为你访问到了禁止你的汇编程序访问的地址。
:::